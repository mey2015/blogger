((i,r)=>{var d={DEBUG:!1,VERSION:"0.0.11",CONTEXT:"player.js"};d.POST_MESSAGE=!!i.postMessage,d.origin=function(e){return(e="//"===e.substr(0,2)?i.location.protocol+e:e).split("/").slice(0,3).join("/")},d.addEvent=function(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)},d.log=function(){d.log.history=d.log.history||[],d.log.history.push(arguments),i.console&&d.DEBUG&&i.console.log(Array.prototype.slice.call(arguments))},d.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},d.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},d.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},d.isNone=function(e){return null==e},d.has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},d.indexOf=function(e,t){if(null!=e){var n=0,i=e.length;if(Array.prototype.IndexOf&&e.indexOf===Array.prototype.IndexOf)return e.indexOf(t);for(;n<i;n++)if(e[n]===t)return n}return-1},d.assert=function(e,t){if(!e)throw t||"Player.js Assert Failed"},d.Keeper=function(){this.init()},d.Keeper.prototype.init=function(){this.data={}},d.Keeper.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},d.Keeper.prototype.has=function(e,t){if(this.data.hasOwnProperty(e)){if(d.isNone(t))return!0;for(var n=this.data[e],i=0;i<n.length;i++)if(n[i].id===t)return!0}return!1},d.Keeper.prototype.add=function(e,t,n,i,r){e={id:e,event:t,cb:n,ctx:i,one:r};this.has(t)?this.data[t].push(e):this.data[t]=[e]},d.Keeper.prototype.execute=function(e,t,n,i){if(!this.has(e,t))return!1;for(var r=[],o=[],s=0;s<this.data[e].length;s++){var a=this.data[e][s];(!d.isNone(t)&&(d.isNone(t)||a.id!==t)||(o.push({cb:a.cb,ctx:a.ctx||i,data:n}),!1===a.one))&&r.push(a)}0===r.length?delete this.data[e]:this.data[e]=r;for(var u=0;u<o.length;u++){var c=o[u];c.cb.call(c.ctx,c.data)}},d.Keeper.prototype.on=function(e,t,n,i){this.add(e,t,n,i,!1)},d.Keeper.prototype.one=function(e,t,n,i){this.add(e,t,n,i,!0)},d.Keeper.prototype.off=function(e,t){var n=[];if(this.data.hasOwnProperty(e)){for(var i=[],r=0;r<this.data[e].length;r++){var o=this.data[e][r];d.isNone(t)||o.cb===t?d.isNone(o.id)||n.push(o.id):i.push(o)}0===i.length?delete this.data[e]:this.data[e]=i}return n},d.Player=function(e,t){if(!(this instanceof d.Player))return new d.Player(e,t);this.init(e,t)},d.EVENTS={READY:"ready",PLAY:"play",PAUSE:"pause",ENDED:"ended",TIMEUPDATE:"timeupdate",PROGRESS:"progress",SEEKED:"seeked",ERROR:"error"},d.EVENTS.all=function(){var e,t=[];for(e in d.EVENTS)d.has(d.EVENTS,e)&&d.isString(d.EVENTS[e])&&t.push(d.EVENTS[e]);return t},d.METHODS={PLAY:"play",PAUSE:"pause",GETPAUSED:"getPaused",MUTE:"mute",UNMUTE:"unmute",GETMUTED:"getMuted",SETVOLUME:"setVolume",GETVOLUME:"getVolume",GETDURATION:"getDuration",SETCURRENTTIME:"setCurrentTime",GETCURRENTTIME:"getCurrentTime",SETLOOP:"setLoop",GETLOOP:"getLoop",REMOVEEVENTLISTENER:"removeEventListener",ADDEVENTLISTENER:"addEventListener"},d.METHODS.all=function(){var e,t=[];for(e in d.METHODS)d.has(d.METHODS,e)&&d.isString(d.METHODS[e])&&t.push(d.METHODS[e]);return t},d.READIED=[],d.Player.prototype.init=function(e,t){var n=this;d.isString(e)&&(e=r.getElementById(e)),this.elem=e,d.assert("IFRAME"===e.nodeName,'playerjs.Player constructor requires an Iframe, got "'+e.nodeName+'"'),d.assert(e.src,"playerjs.Player constructor requires a Iframe with a 'src' attribute."),this.origin=d.origin(e.src),this.keeper=new d.Keeper,this.isReady=!1,this.queue=[],this.events=d.EVENTS.all(),this.methods=d.METHODS.all(),d.POST_MESSAGE?d.addEvent(i,"message",function(e){n.receive(e)}):d.log("Post Message is not Available."),-1<d.indexOf(d.READIED,e.src)?n.loaded=!0:this.elem.onload=function(){n.loaded=!0}},d.Player.prototype.send=function(e,t,n){var i;return e.context=d.CONTEXT,e.version=d.VERSION,t&&(i=this.keeper.getUUID(),e.listener=i,this.keeper.one(i,e.method,t,n)),this.isReady||"ready"===e.value?(d.log("Player.send",e,this.origin),!0===this.loaded&&this.elem.contentWindow.postMessage(JSON.stringify(e),this.origin),!0):(d.log("Player.queue",e),this.queue.push(e),!1)},d.Player.prototype.receive=function(e){if(d.log("Player.receive",e),e.origin!==this.origin)return!1;var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==d.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src===this.elem.src&&this.ready(t),this.keeper.has(t.event,t.listener)&&this.keeper.execute(t.event,t.listener,t.value,this)},d.Player.prototype.ready=function(e){if(!0===this.isReady)return!1;e.value.events&&(this.events=e.value.events),e.value.methods&&(this.methods=e.value.methods),this.isReady=!0,this.loaded=!0;for(var t=0;t<this.queue.length;t++){var n=this.queue[t];d.log("Player.dequeue",n),"ready"===e.event&&this.keeper.execute(n.event,n.listener,!0,this),this.send(n)}this.queue=[]},d.Player.prototype.on=function(e,t,n){var i=this.keeper.getUUID();return"ready"===e?this.keeper.one(i,e,t,n):this.keeper.on(i,e,t,n),this.send({method:"addEventListener",value:e,listener:i}),!0},d.Player.prototype.off=function(e,t){var n=this.keeper.off(e,t);if(d.log("Player.off",n),0<n.length)for(var i in n)return this.send({method:"removeEventListener",value:e,listener:n[i]}),!0;return!1},d.Player.prototype.supports=function(e,t){d.assert(-1<d.indexOf(["method","event"],e),'evtOrMethod needs to be either "event" or "method" got '+e),t=d.isArray(t)?t:[t];for(var n="event"===e?this.events:this.methods,i=0;i<t.length;i++)if(-1===d.indexOf(n,t[i]))return!1;return!0};for(var e=0,t=d.METHODS.all().length;e<t;e++){var n=d.METHODS.all()[e];d.Player.prototype.hasOwnProperty(n)||(d.Player.prototype[n]=(n=>function(){var e={method:n},t=Array.prototype.slice.call(arguments);/^get/.test(n)?(d.assert(0<t.length,"Get methods require a callback."),t.unshift(e)):(/^set/.test(n)&&(d.assert(0!==t.length,"Set methods require a value."),e.value=t[0]),t=[e]),this.send.apply(this,t)})(n))}d.addEvent(i,"message",function(e){var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==d.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src&&d.READIED.push(t.value.src)}),d.Receiver=function(e,t){this.init(e,t)},d.Receiver.prototype.init=function(e,t){var n=this;this.isReady=!1,this.origin=d.origin(r.referrer),this.methods={},this.supported={events:e||d.EVENTS.all(),methods:t||d.METHODS.all()},this.eventListeners={},this.reject=!(i.self!==i.top&&d.POST_MESSAGE),this.reject||d.addEvent(i,"message",function(e){n.receive(e)})},d.Receiver.prototype.receive=function(e){if(e.origin!==this.origin)return!1;var t,n={};if(d.isObject(e.data))n=e.data;else try{n=i.JSON.parse(e.data)}catch(e){d.log("JSON Parse Error",e)}return d.log("Receiver.receive",e,n),!!n.method&&n.context===d.CONTEXT&&(-1===d.indexOf(d.METHODS.all(),n.method)?(this.emit("error",{code:2,msg:'Invalid Method "'+n.method+'"'}),!1):(e=d.isNone(n.listener)?null:n.listener,void("addEventListener"===n.method?(this.eventListeners.hasOwnProperty(n.value)?-1===d.indexOf(this.eventListeners[n.value],e)&&this.eventListeners[n.value].push(e):this.eventListeners[n.value]=[e],"ready"===n.value&&this.isReady&&this.ready()):"removeEventListener"===n.method?this.eventListeners.hasOwnProperty(n.value)&&(-1<(t=d.indexOf(this.eventListeners[n.value],e))&&this.eventListeners[n.value].splice(t,1),0===this.eventListeners[n.value].length)&&delete this.eventListeners[n.value]:this.get(n.method,n.value,e))))},d.Receiver.prototype.get=function(t,e,n){var i=this;if(!this.methods.hasOwnProperty(t))return this.emit("error",{code:3,msg:'Method Not Supported"'+t+'"'}),!1;var r=this.methods[t];"get"===t.substr(0,3)?r.call(this,function(e){i.send(t,e,n)}):r.call(this,e)},d.Receiver.prototype.on=function(e,t){this.methods[e]=t},d.Receiver.prototype.send=function(e,t,n){if(d.log("Receiver.send",e,t,n),this.reject)return d.log("Receiver.send.reject",e,t,n),!1;e={context:d.CONTEXT,version:d.VERSION,event:e},d.isNone(t)||(e.value=t),d.isNone(n)||(e.listener=n),t=JSON.stringify(e);i.parent.postMessage(t,""===this.origin?"*":this.origin)},d.Receiver.prototype.emit=function(e,t){if(!this.eventListeners.hasOwnProperty(e))return!1;d.log("Instance.emit",e,t,this.eventListeners[e]);for(var n=0;n<this.eventListeners[e].length;n++){var i=this.eventListeners[e][n];this.send(e,t,i)}return!0},d.Receiver.prototype.ready=function(){d.log("Receiver.ready"),this.isReady=!0;var e={src:i.location.toString(),events:this.supported.events,methods:this.supported.methods};this.emit("ready",e)||this.send("ready",e)},d.HTML5Adapter=function(e){if(!(this instanceof d.HTML5Adapter))return new d.HTML5Adapter(e);this.init(e)},d.HTML5Adapter.prototype.init=function(t){d.assert(t,"playerjs.HTML5Adapter requires a video element");var e=this.receiver=new d.Receiver;t.addEventListener("playing",function(){e.emit("play")}),t.addEventListener("pause",function(){e.emit("pause")}),t.addEventListener("ended",function(){e.emit("ended")}),t.addEventListener("timeupdate",function(){e.emit("timeupdate",{seconds:t.currentTime,duration:t.duration})}),t.addEventListener("progress",function(){e.emit("buffered",{percent:t.buffered.length})}),e.on("play",function(){t.play()}),e.on("pause",function(){t.pause()}),e.on("getPaused",function(e){e(t.paused)}),e.on("getCurrentTime",function(e){e(t.currentTime)}),e.on("setCurrentTime",function(e){t.currentTime=e}),e.on("getDuration",function(e){e(t.duration)}),e.on("getVolume",function(e){e(100*t.volume)}),e.on("setVolume",function(e){t.volume=e/100}),e.on("mute",function(){t.muted=!0}),e.on("unmute",function(){t.muted=!1}),e.on("getMuted",function(e){e(t.muted)}),e.on("getLoop",function(e){e(t.loop)}),e.on("setLoop",function(e){t.loop=e})},d.HTML5Adapter.prototype.ready=function(){this.receiver.ready()},d.JWPlayerAdapter=function(e){if(!(this instanceof d.JWPlayerAdapter))return new d.JWPlayerAdapter(e);this.init(e)},d.JWPlayerAdapter.prototype.init=function(t){d.assert(t,"playerjs.JWPlayerAdapter requires a player object");var n=this.receiver=new d.Receiver,e=(this.looped=!1,t.on("pause",function(){n.emit("pause")}),t.on("play",function(){n.emit("play")}),t.on("time",function(e){var t=e.position,e=e.duration;if(!t||!e)return!1;n.emit("timeupdate",{seconds:t,duration:e})}),this);t.on("complete",function(){!0===e.looped?t.seek(0):n.emit("ended")}),t.on("error",function(){n.emit("error")}),n.on("play",function(){t.play(!0)}),n.on("pause",function(){t.pause(!0)}),n.on("getPaused",function(e){e(t.getState().toLowerCase()!=="PLAYING".toLowerCase())}),n.on("getCurrentTime",function(e){e(t.getPosition())}),n.on("setCurrentTime",function(e){t.seek(e)}),n.on("getDuration",function(e){e(t.getDuration())}),n.on("getVolume",function(e){e(t.getVolume())}),n.on("setVolume",function(e){t.setVolume(e)}),n.on("mute",function(){t.setMute(!0)}),n.on("unmute",function(){t.setMute(!1)}),n.on("getMuted",function(e){e(!0===t.getMute())}),n.on("getLoop",function(e){e(this.looped)},this),n.on("setLoop",function(e){this.looped=e},this)},d.JWPlayerAdapter.prototype.ready=function(){this.receiver.ready()},d.MockAdapter=function(){if(!(this instanceof d.MockAdapter))return new d.MockAdapter;this.init()},d.MockAdapter.prototype.init=function(){var n={duration:20,currentTime:0,interval:null,timeupdate:function(){},volume:100,mute:!1,playing:!1,loop:!1,play:function(){n.interval=setInterval(function(){n.currentTime+=.25,n.timeupdate({seconds:n.currentTime,duration:n.duration})},250),n.playing=!0},pause:function(){clearInterval(n.interval),n.playing=!1}},e=this.receiver=new d.Receiver;e.on("play",function(){var t=this;n.play(),this.emit("play"),n.timeupdate=function(e){t.emit("timeupdate",e)}}),e.on("pause",function(){n.pause(),this.emit("pause")}),e.on("getPaused",function(e){e(!n.playing)}),e.on("getCurrentTime",function(e){e(n.currentTime)}),e.on("setCurrentTime",function(e){n.currentTime=e}),e.on("getDuration",function(e){e(n.duration)}),e.on("getVolume",function(e){e(n.volume)}),e.on("setVolume",function(e){n.volume=e}),e.on("mute",function(){n.mute=!0}),e.on("unmute",function(){n.mute=!1}),e.on("getMuted",function(e){e(n.mute)}),e.on("getLoop",function(e){e(n.loop)}),e.on("setLoop",function(e){n.loop=e})},d.MockAdapter.prototype.ready=function(){this.receiver.ready()},d.VideoJSAdapter=function(e){if(!(this instanceof d.VideoJSAdapter))return new d.VideoJSAdapter(e);this.init(e)},d.VideoJSAdapter.prototype.init=function(i){d.assert(i,"playerjs.VideoJSReceiver requires a player object");var r=this.receiver=new d.Receiver;i.on("pause",function(){r.emit("pause")}),i.on("play",function(){r.emit("play")}),i.on("timeupdate",function(e){var t=i.currentTime(),n=i.duration();if(!t||!n)return!1;r.emit("timeupdate",{seconds:t,duration:n})}),i.on("ended",function(){r.emit("ended")}),i.on("error",function(){r.emit("error")}),r.on("play",function(){i.play()}),r.on("pause",function(){i.pause()}),r.on("getPaused",function(e){e(i.paused())}),r.on("getCurrentTime",function(e){e(i.currentTime())}),r.on("setCurrentTime",function(e){i.currentTime(e)}),r.on("getDuration",function(e){e(i.duration())}),r.on("getVolume",function(e){e(100*i.volume())}),r.on("setVolume",function(e){i.volume(e/100)}),r.on("mute",function(){i.volume(0)}),r.on("unmute",function(){i.volume(1)}),r.on("getMuted",function(e){e(0===i.volume())}),r.on("getLoop",function(e){e(i.loop())}),r.on("setLoop",function(e){i.loop(e)})},d.VideoJSAdapter.prototype.ready=function(){this.receiver.ready()},"function"==typeof define&&define.amd?define(function(){return d}):"object"==typeof module&&module.exports?module.exports=d:i.playerjs=d})(window,document);
